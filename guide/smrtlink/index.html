<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>SMRTLink/SMRTAnalysis using Command Line | SCINet | USDA Scientific Computing Initiative</title>



<meta name="description" content="Guide to use SMRTLink via CLI">



<link rel="shortcut icon" type="image/ico"
  href="/assets/uswds/img/favicons/favicon.ico">

<link rel="icon" type="image/png"
  href="/assets/uswds/img/favicons/favicon.png">

<link rel="icon" type="image/png"
  sizes="192x192"
  href="/assets/uswds/img/favicons/favicon-192.png">

<link rel="apple-touch-icon-precomposed" type=""
  href="/assets/uswds/img/favicons/favicon-57.png">

<link rel="apple-touch-icon-precomposed" type=""
  sizes="72x72"
  href="/assets/uswds/img/favicons/favicon-72.png">

<link rel="apple-touch-icon-precomposed" type=""
  sizes="114x114"
  href="/assets/uswds/img/favicons/favicon-114.png">

<link rel="apple-touch-icon-precomposed" type=""
  sizes="144x144"
  href="/assets/uswds/img/favicons/favicon-144.png">



    



<link rel="stylesheet"
  href="/assets/css/uswds-theme.css"
  media="screen">


    
      
<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-27627304-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());

  // `forceSSL` was used for analytics.js (the older Google Analytics script). It isn't documented for gtag.js, but the term occurs in the gtag.js code; figure it doesn't hurt to leave it in. -@afeld, 5/29/19
  gtag('config', 'UA-27627304-1', { 'anonymize_ip': true, 'forceSSL': true });
</script>



<!-- Digital Analytics Program roll-up, see https://analytics.usa.gov for data -->
<script id="_fed_an_ua_tag" src="https://dap.digitalgov.gov/Universal-Federated-Analytics-Min.js?agency=USDA&subagency=ARS"></script>


    
  </head>
  <body class="  site-90%">

    <a class="usa-skipnav" href="#main-content">Skip to main content</a>

    


  <section class="usa-banner" aria-label="Official government website">
  <div class="usa-accordion">
    <header class="usa-banner__header">
      <div class="usa-banner__inner">
        <div class="grid-col-auto">
          <img class="usa-banner__header-flag" src="/assets/uswds/img/us_flag_small.png" alt="U.S. flag">
        </div>
        <div class="grid-col-fill tablet:grid-col-auto">
          <p class="usa-banner__header-text">An official website of the United States government</p>
          <p class="usa-banner__header-action" aria-hidden="true">Here’s how you know</p>
        </div>
        <button class="usa-accordion__button usa-banner__button"
          aria-expanded="false" aria-controls="gov-banner">
          <span class="usa-banner__button-text">Here’s how you know</span>
        </button>
      </div>
    </header>
    <div class="usa-banner__content usa-accordion__content" id="gov-banner">
      <div class="grid-row grid-gap-lg">
        <div class="usa-banner__guidance tablet:grid-col-6">
          <img class="usa-banner__icon usa-media-block__img" src="/assets/uswds/img/icon-dot-gov.svg" role="img" alt="Dot gov">
          <div class="usa-media-block__body">
            <p>
              <strong>Official websites use .gov</strong>
              <br/>
              A <strong>.gov</strong> website belongs to an official government organization in the United States.
            </p>
          </div>
        </div>
        <div class="usa-banner__guidance tablet:grid-col-6">
          <img class="usa-banner__icon usa-media-block__img" src="/assets/uswds/img/icon-https.svg" role="img" alt="Https">
          <div class="usa-media-block__body">
            <p>
              <strong>Secure .gov websites use HTTPS</strong>
              <br/>
              A <strong>lock</strong> (
<span class="icon-lock"><svg xmlns="http://www.w3.org/2000/svg" width="52" height="64" viewBox="0 0 52 64" class="usa-banner__lock-image" role="img" aria-labelledby="banner-lock-title banner-lock-description"><title id="banner-lock-title">Lock</title><desc id="banner-lock-description">A locked padlock</desc><path fill="#000000" fill-rule="evenodd" d="M26 0c10.493 0 19 8.507 19 19v9h3a4 4 0 0 1 4 4v28a4 4 0 0 1-4 4H4a4 4 0 0 1-4-4V32a4 4 0 0 1 4-4h3v-9C7 8.507 15.507 0 26 0zm0 8c-5.979 0-10.843 4.77-10.996 10.712L15 19v9h22v-9c0-6.075-4.925-11-11-11z"/></svg></span>
) or <strong>https://</strong> means you’ve safely connected to the .gov website. Share sensitive information only on official, secure websites.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>



  <div class="usa-overlay"></div>

  <header class="usa-header usa-header--extended" role="banner">


  
    <div class="usa-navbar">
      <div class="usa-logo" id="header-logo">
        <a
          href="/"
          title="Home">
          
            <img
              class="usa-logo-img"
              src="/assets/img/usda-symbol-rgb-color.svg"
              alt="USDA-ARS">
          
          <em class="usa-logo__text">
            SCINet Scientific Computing
          </em>
        </a>
      </div>
      <button class="usa-menu-btn">Menu</button>
    </div>

    <nav role="navigation" class="usa-nav">
      <div class="usa-nav__inner">
        <button class="usa-nav__close">
          <img src="/assets/uswds/img/close.svg" alt="close">
        </button>

        
        
        
        <ul class="usa-nav__primary usa-accordion">
          
          <li class="usa-nav__primary-item">
            
              <a class=" usa-nav__link  " href="/signup/">
                <span>Sign up for an account</span>
              </a>
            
          </li>
          
          <li class="usa-nav__primary-item">
            
              
              
              
            <button class="usa-accordion__button usa-nav__link" aria-expanded="false" aria-controls="nav-2">
              <span>News</span>
            </button>
            
            <ul id="nav-2" class="usa-nav__submenu">
            
            
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/downtime/">System Downtime</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/announcements/">Announcements</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/stories/">User Stories</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/newsletter/">Newsletter</a>
                </li>
                
              
            
            </ul>
            
            
            
          </li>
          
          <li class="usa-nav__primary-item">
            
              
              
              
            <button class="usa-accordion__button usa-nav__link" aria-expanded="false" aria-controls="nav-3">
              <span>User Guides</span>
            </button>
            
            <ul id="nav-3" class="usa-nav__submenu">
            
            
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/guide/quickstart">Quick Start</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/guide/ceres">Ceres HPC User manual</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="https://www.hpc.msstate.edu/computing/atlas">Atlas HPC User Guide</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/guide/ceres2atlas">Transitioning from Ceres to Atlas</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/guide/multifactor">Set up multifactor authentication</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/guide/storage">SCINet Storage Guide</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/guide/software">Software Overview</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/guide/packageinstall">Installing R/Python/Perl Packages</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/guide/conda">Installing Software with Conda</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/guide/file-transfer">Transferring files</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/guide/rclone">Rclone</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/guide/jupyter">Jupyter</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/guide/rstudio">Rstudio</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/guide/geneious">Geneious</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/guide/galaxy">Galaxy on SCINet</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/guide/singularity">Containers</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/guide/smrtlink">SMRTLink using Command Line</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/guide/AWS/documentation">AWS Resources</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/guide/vpn">SCINet VPN</a>
                </li>
                
              
            
            </ul>
            
            
            
          </li>
          
          <li class="usa-nav__primary-item">
            
              
              
              
            <button class="usa-accordion__button usa-nav__link" aria-expanded="false" aria-controls="nav-4">
              <span>Working Groups</span>
            </button>
            
            <ul id="nav-4" class="usa-nav__submenu">
            
            
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/working-groups">Overview</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/working-groups/ag100pest">Ag100Pest</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/working-groups/arthropods">Arthropod Genomics</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/working-groups/geospatial">Geospatial Research</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/working-groups/microbiome">Microbiome</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/working-groups/LTARphenology">LTAR Phenology</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/working-groups/policy">SCINet Policy Committee</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/working-groups/webdev">SCINet Website Developers</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/working-groups/workbooks">Workbook Developers</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/working-groups/pollinator">Pollinator</a>
                </li>
                
              
            
            </ul>
            
            
            
          </li>
          
          <li class="usa-nav__primary-item">
            
              
              
              
            <button class="usa-accordion__button usa-nav__link" aria-expanded="false" aria-controls="nav-5">
              <span>Training</span>
            </button>
            
            <ul id="nav-5" class="usa-nav__submenu">
            
            
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/training/">Overview</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/training/tutorials/">ARS Science Tutorials</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/training/free-online-training">Free Online Training</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/training-archive/">Training Event Archive</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/training/bioinformatics-workbook">Bioinformatics Workbook</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/training/useful-links">Useful Links</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/training/coursera">Coursera</a>
                </li>
                
              
            
            </ul>
            
            
            
          </li>
          
          <li class="usa-nav__primary-item">
            
              
              
              
            <button class="usa-accordion__button usa-nav__link" aria-expanded="false" aria-controls="nav-6">
              <span>Use Cases</span>
            </button>
            
            <ul id="nav-6" class="usa-nav__submenu">
            
            
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/user/genomics/">Genomics</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/user/plant-breeding/">Plant breeding</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/user/geospatial/">Geospatial</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/user/hydrology/">Hydrology</a>
                </li>
                
              
            
            </ul>
            
            
            
          </li>
          
          <li class="usa-nav__primary-item">
            
              
              
              
            <button class="usa-accordion__button usa-nav__link" aria-expanded="false" aria-controls="nav-7">
              <span>Support</span>
            </button>
            
            <ul id="nav-7" class="usa-nav__submenu">
            
            
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/support/vrsc/">Virtual Research Support Core (VSRC)</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/support/faq/">FAQ's</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="https://forum.scinet.usda.gov">USDA-ARS SCINet Forum</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/support/request-storage">Request Project Storage</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/support/request-software">Request Software</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/support/request-AWS">Request AWS</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/support/ceres-job-script">Ceres Job Script Generator</a>
                </li>
                
              
            
            </ul>
            
            
            
          </li>
          
          <li class="usa-nav__primary-item">
            
              
              
              
            <button class="usa-accordion__button usa-nav__link" aria-expanded="false" aria-controls="nav-8">
              <span>About</span>
            </button>
            
            <ul id="nav-8" class="usa-nav__submenu">
            
            
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/about/compute">Computer Systems</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/about/organization">Organization</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/about/contact">Contact</a>
                </li>
                
              
            
            </ul>
            
            
            
          </li>
          
          <li class="usa-nav__primary-item">
            
              
              
              
            <button class="usa-accordion__button usa-nav__link" aria-expanded="false" aria-controls="nav-9">
              <span>Opportunities</span>
            </button>
            
            <ul id="nav-9" class="usa-nav__submenu">
            
            
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/opportunities/SAC">SAC Membership</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/opportunities/request-workshop">Request a Workshop</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/opportunities/postdocs">Fellowships (PhD & MS)</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/opportunities/events">Upcoming Events</a>
                </li>
                
              
                
                <li class="usa-nav__submenu-item">
                  <a href="/opportunities/ai-innovation">AI Innovation fund</a>
                </li>
                
              
            
            </ul>
            
            
            
          </li>
          
        </ul>
        

        

        
          
          <div class="usa-nav__secondary">
            <ul class="usa-unstyled-list usa-nav__secondary-links">
              
              
                <li class="usa-nav__secondary-item">
                  <a href=""
                  >
                    
                  </a>
                </li>
              
            </ul>
            
              <form
                accept-charset="UTF-8"
                action="https://search.usa.gov/search"
                id="search_form"
                method="get"
                class="usa-search usa-search--small js-search-form">
              <input
                name="utf8"
                type="hidden"
                value="&#x2713;" />
              <input
                type="hidden"
                name="affiliate"
                id="affiliate"
                value="scinet-usda" />
                <div role="search">
                  <label
                    for="query" class="usa-sr-only">Enter search terms</label>
                  <input
                    autocomplete="off"
                    class="usa-input usagov-search-autocomplete"
                    id="query"
                    name="query"
                    type="search" />
                  <button
                    class="usa-button"
                    type="submit"
                    name="commit">
                    <span class="usa-sr-only">Search</span>
                  </button>
                </div>
              </form>
            
          </div>
          


        </div>
      </div>
    </nav>
  
  </header>




    
    


    

    

    
      
      




    
    

    
      <main id="main-content" class="usa-layout-docs usa-layout-docs__main desktop:grid-col-9 usa-prose">
        <div class="usa-section">
  <div class="grid-container">
    <div class="grid-row grid-gap flex-align-start">
      
      

      <main class="usa-layout-docs usa-layout-docs__main usa-prose" id="main-content">
        
          <h1>SMRTLink/SMRTAnalysis using Command Line</h1>
        
        <h4 id="table-of-contents">Table of Contents</h4>
<ul>
  <li><a href="#instructions-for-smrtlink-v7">Instructions for SMRTLink v7</a>
    <ul>
      <li><a href="#view-the-available-pipelines">View the available pipelines</a></li>
      <li><a href="#generate-a-template-file-for-pipelines">Generate a template file for pipelines</a></li>
      <li><a href="#check-available-entry-points-for-the-pipeline">Check available entry points (inputs) for the pipeline</a></li>
      <li><a href="#generate-workflow-template">Generate workflow template</a></li>
      <li><a href="#generate-a-dataset">Generate a dataset</a></li>
      <li><a href="#Sample-sbatch-script">Sample sbatch script</a></li>
    </ul>
  </li>
  <li><a href="#instructions-for-smrtlink-v10">Instructions for SMRTLink v10</a>
    <ul>
      <li><a href="#view-the-available-workflows">View the available workflows</a></li>
      <li><a href="#view-input-options-for-a-workflow">View input options for a workflow</a></li>
      <li><a href="#use-cromwell-config-files-for-ceres">Use cromwell config files for Ceres</a></li>
      <li><a href="#sample-batch-script">Sample batch script</a></li>
    </ul>
  </li>
</ul>

<h2 id="instructions-for-smrtlink-v7">Instructions for SMRTLink v7</h2>

<p>Although SMRTLink GUI is useful, it can be very limited. In particular, currently one can not use priority nodes or high memory nodes through SMRTLink GUI. GUI service may also be unavailable at times. This, however, does not affect SMRTLink command line which does not need the GUI service to be alive.</p>

<h3 id="view-the-available-pipelines">View the available pipelines</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>module load smrtlink/7.0.0
pbsmrtpipe show-templates
********************************************************
21 Registered User Pipelines (name -&gt; version, id, tags)
********************************************************
  1. Assembly (HGAP 4)                                        0.2.1    pbsmrtpipe.pipelines.polished_falcon_fat
      denovo
  2. Base Modification Detection                              0.1.0    pbsmrtpipe.pipelines.ds_modification_detection
      modification-detection
  3. Base Modification and Motif Analysis                     0.1.0    pbsmrtpipe.pipelines.ds_modification_motif_analysis    
      motif-analysis
  4. CCS with Mapping                                         0.1.0    pbsmrtpipe.pipelines.sl_subreads_to_ccs_align
      ccs,mapping
  5. Circular Consensus Sequences (CCS)                       0.2.0    pbsmrtpipe.pipelines.sl_subreads_to_ccs
      ccs
  6. Convert BAM to FASTX                                     0.1.0    pbsmrtpipe.pipelines.sa3_ds_subreads_to_fastx
      converters
  7. Convert RS to BAM                                        0.1.0    pbsmrtpipe.pipelines.sa3_hdfsubread_to_subread
      converters
  8. Demultiplex Barcodes                                     0.1.0    pbsmrtpipe.pipelines.sl_ccs_barcode
      barcode,ccs
  9. Demultiplex Barcodes                                     0.1.0    pbsmrtpipe.pipelines.sa3_ds_barcode2_manual
      barcode
 10. Iso-Seq                                                  0.1.1    pbsmrtpipe.pipelines.sa3_ds_isoseq3
      ccs,isoseq
 11. Iso-Seq Classify Only                                    0.1.1    pbsmrtpipe.pipelines.sa3_ds_isoseq3_classify
      ccs,isoseq
 12. Iso-Seq with Mapping                                     0.1.0    pbsmrtpipe.pipelines.sa3_ds_isoseq3_with_genome
      ccs,isoseq
 13. Long Amplicon Analysis (LAA)                             0.2.0    pbsmrtpipe.pipelines.sa3_ds_laa
      laa
 14. Long Amplicon Analysis with Guided Clustering (LAAgc)    0.1.0    pbsmrtpipe.pipelines.sa3_ds_laagc
      alpha,laa
 15. Mapping                                                  0.1.0    pbsmrtpipe.pipelines.sl_align_ccs
      ccs,mapping
 16. Minor Variants Analysis                                  0.2.0    pbsmrtpipe.pipelines.sl_minorseq_ccs
      minorvariants
 17. Minor Variants Analysis                                  0.2.0    pbsmrtpipe.pipelines.sa3_ds_minorseq
      beta,minorvariants
 18. Resequencing                                             0.2.0    pbsmrtpipe.pipelines.sl_resequencing2
      consensus,mapping,reports
 19. Site Acceptance Test (SAT)                               0.1.0    pbsmrtpipe.pipelines.sa3_sat
      consensus,mapping,reports,sat
 20. Structural Variant Calling                               2.0.0    pbsmrtpipe.pipelines.sa3_ds_sv2_ccs
      ccs,sv
 21. Structural Variant Calling                               2.0.0    pbsmrtpipe.pipelines.sa3_ds_sv2
      sv
Run with --show-all to display (unsupported) developer/internal pipelines
</code></pre></div></div>

<h3 id="generate-a-template-file-for-pipelines">Generate a template file for pipelines</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pbsmrtpipe show-template-details &lt;pipeline ID&gt; -j &lt;filename&gt;.json
</code></pre></div></div>

<p>Example below shows how to generate a template file for HGAP4 assembly.
The generated JSON file will contain options in the form of “KEY”: “VALUE“ that users could edit.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pbsmrtpipe show-template-details pbsmrtpipe.pipelines.polished_falcon_fat \
-j HGAP4-template.json
</code></pre></div></div>

<h3 id="check-available-entry-points-inputs-for-the-pipeline">Check available entry points (inputs) for the pipeline</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pbsmrtpipe show-template-details pbsmrtpipe.pipelines.polished_falcon_fat | grep -i entry
**** Entry points (1) ****
$entry:eid_subread
</code></pre></div></div>

<p>The value next to the “Entry points“ indicates the number of entry points. In this case, the entry point is a subreadset file. If a subreadset file does not exist or if there multiple subreadset files that you want to combine, <a href="#generate-a-dataset">click here</a> for instructions to create datasets.</p>

<h3 id="generate-workflow-template">Generate workflow template</h3>

<p>This template is used to talk to SLURM workload manager to divvy up tasks</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pbsmrtpipe show-workflow-options -j workflow-template.json
</code></pre></div></div>

<p>To submit jobs to a different partition replace the value for the pbsmrtpipe.options.cluster_manager KEY in the generated workflow template file with one of the provided options as shown below:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"pbsmrtpipe.options.cluster_manager": "/system/smrtanalysis/7/slurm_template/short"
"pbsmrtpipe.options.cluster_manager": "/system/smrtanalysis/7/slurm_template/medium"
"pbsmrtpipe.options.cluster_manager": "/system/smrtanalysis/7/slurm_template/mem"
</code></pre></div></div>

<p>Users can also copy the template directory and modify values to specify a different partition. For example, to submit jobs to priority partition, in your copy of the template directory make the following changes in file <em>jmsenv_00.ish</em> :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>JMSCONFIG_SLURM_PARTITION="priority";   # Partition 
JMSCONFIG_SLURM_START_ARGS='--qos=gbru --timelimit=7-00:00:00';  # gbru is a example, choose relevant QOS
</code></pre></div></div>

<p>in file <em>start.tmpl</em> :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--jmsenv "&lt;path_to_your_template_directory&gt;/jmsenv_00.ish" # Change the path to your custom template file
</code></pre></div></div>

<p>After these changes, make sure <em>“pbsmrtpipe.options.cluster_manager”:</em> in the workflow template file points to your template directory.</p>

<blockquote>
  <p>Note that only research groups that purchased nodes on the Ceres cluster have access to priority partitions.</p>
</blockquote>

<h3 id="generating-a-dataset">Generating a dataset</h3>

<p>Raw BAM files are usually accompanied by several XML files. In case the users don’t have these XML files, they can use the following command:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dataset create
</code></pre></div></div>

<p>This command takes BAM, file of file names (fofn) or XML files as input.</p>

<p>For example, to analyze multiple XML SubreadSet files together, issue:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dataset create xyz123-combined.subreadset.xml *.subreadset.xml
</code></pre></div></div>

<p>The following types are supported - <em>HdfSubreadSet, TranscriptAlignmentSet, ContigSet, DataSet,ConsensusReadSet, TranscriptSet, BarcodeSet, ReferenceSet, ConsensusAlignmentSet, GmapReferenceSet, AlignmentSet, SubreadSet</em></p>

<h3 id="sample-sbatch-script">Sample sbatch script</h3>

<p>After creating datasets, generating templates and making necessary changes, submit a batch job using sbatch command. Below is a sample job script to submit HGAP4 assembly using smrklink v7</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/bin/bash

#SBATCH --job-name=HGAP4_assembly
#SBATCH --cpus-per-task=1
#SBATCH --ntasks=2
#SBATCH --mem-per-cpu=4000
#SBATCH --partition=long
#SBATCH --output=HGAP4__%j.std
#SBATCH --error=HGAP4__%j.err

module load smrtlink/7.0.0
export HOME=/home/${USER}

pbsmrtpipe pipeline-id pbsmrtpipe.pipelines.polished_falcon_fat -e eid_subread:HGAP4-subreadset.xml \
--preset-json HGAP4-template.json --preset-json workflow-template.json \
--output-dir /path/to/output/dir

### Commands to get the above information ###

# Pipeline id - pbsmrtpipe show-templates
# Create dataset - dataset create HGAP4-subreadset.xml *.subreadset.xml
# Generate template for assembly - pbsmrtpipe show-template-details pbsmrtpipe.pipelines.polished_falcon_fat -j HGAP4-template.json
# Generate workflow template - pbsmrtpipe show-workflow-options -j workflow-template.json
# To check the available entry points - pbsmrtpipe show-template-details pbsmrtpipe.pipelines.polished_falcon_fat

#**** Pipeline Summary ****
#id            : pbsmrtpipe.pipelines.polished_falcon_fat
#version       : 0.2.1
#name          : Assembly (HGAP 4)
#Tags       : denovo
#Description:
# Same as polished_falcon_lean, but with reports.

#**** Entry points (1) ****
#$entry:eid_subread
</code></pre></div></div>

<h2 id="instructions-for-smrtlink-v10">Instructions for SMRTLink v10</h2>

<p>Unlike v7 of SMRTLink, v10 uses <a href="https://cromwell.readthedocs.io/en/stable/">Cromwell workflow manager</a> which offers additional flexibility and compatibility with SLURM. Commandline version of v10 does not depend on web GUI service and is always available.</p>

<p>There are two main steps involved - provide input parameters for your workflow and then submit the job via SLURM.</p>

<h3 id="view-the-available-workflows">View the available workflows</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>module load smrtlink/10.0.0
$ pbcromwell show-workflows


cromwell.workflows.pb_hgap4: Assembly (HGAP4)
cromwell.workflows.pb_basemods: Base Modification Analysis
cromwell.workflows.pb_ccs_demux: CCS with Demultiplexing
cromwell.workflows.pb_ccs_mapping: CCS with Mapping
cromwell.workflows.pb_ccs: Circular Consensus Sequencing (CCS)
cromwell.workflows.pb_bam2fastx: Convert BAM to FASTX
cromwell.workflows.pb_demux_subreads: Demultiplex Barcodes
cromwell.workflows.pb_demux_ccs: Demultiplex Barcodes
cromwell.workflows.pb_export_ccs: Export Reads
cromwell.workflows.pb_assembly_hifi: Genome Assembly
cromwell.workflows.pb_isoseq3_ccsonly: Iso-Seq Analysis
cromwell.workflows.pb_isoseq3: Iso-Seq Analysis
cromwell.workflows.pb_laa: Long Amplicon Analysis (LAA)
cromwell.workflows.pb_align_subreads: Mapping
cromwell.workflows.pb_align_ccs: Mapping
cromwell.workflows.pb_mark_duplicates: Mark PCR Duplicates
cromwell.workflows.pb_assembly_microbial: Microbial Assembly
cromwell.workflows.pb_mv_ccs: Minor Variants Analysis
cromwell.workflows.pb_resequencing: Resequencing
cromwell.workflows.pb_sat: Site Acceptance Test (SAT)
cromwell.workflows.pb_sv_ccs: Structural Variant Calling
cromwell.workflows.pb_sv_clr: Structural Variant Calling
cromwell.workflows.pb_trim_adapters: Trim gDNA Amplification Adapters
</code></pre></div></div>

<h3 id="view-input-options-for-a-workflow">View input options for a workflow</h3>

<p>Using <em>Genome Assembly</em> as an example -</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pbcromwell show-workflow-details pb_assembly_hifi


Workflow Summary
Workflow Id    : cromwell.workflows.pb_assembly_hifi
Name           : Genome Assembly
Description    : Genome assembly at any scale using HiFi reads
Required Inputs:
Optional Inputs: ConsensusReadSet XML
Tags           : ccs, assembly, cromwell
Task Options:
  reads = None
    Reads (file)
  ipa2_genome_size = 0
    Genome Length (integer)
  ipa2_downsampled_coverage = 0
    Downsampled coverage (integer)
  ipa2_advanced_options =
    Advanced Assembly Options (string)
  ipa2_run_polishing = True
    Run polishing (boolean)
  ipa2_run_phasing = True
    Run phasing (boolean)
  ipa2_run_purge_dups = True
    Purge duplicate contigs from the assembly (boolean)
  ipa2_ctg_prefix = ctg.
    Ipa2 ctg prefix (string)
  ipa2_reads_db_prefix = reads
    Ipa2 reads db prefix (string)
  ipa2_cleanup_intermediate_files = True
    Cleanup intermediate files (boolean)
  dataset_filters =
    Filters to Add to the Data Set (string)
  filter_min_qv = 20
    Min. CCS Predicted Accuracy (Phred Scale) (integer)


Example Usage:

  $ pbcromwell run pb_assembly_hifi \

  $ pbcromwell run pb_assembly_hifi \
      -e input1.consensusreadset.xml \
      --task-option reads=None \
      --task-option ipa2_genome_size=0 \
      --task-option ipa2_downsampled_coverage=0 \
      --task-option ipa2_advanced_options="" \
      --task-option ipa2_run_polishing=True \
      --task-option ipa2_run_phasing=True \
      --task-option ipa2_run_purge_dups=True \
      --task-option ipa2_ctg_prefix="ctg." \
      --task-option ipa2_reads_db_prefix="reads" \
      --task-option ipa2_cleanup_intermediate_files=True \
      --task-option dataset_filters="" \
      --task-option filter_min_qv=20 \
      --config cromwell.conf \
      --nproc 8
</code></pre></div></div>

<h3 id="use-cromwell-config-files-for-ceres">Use cromwell config files for Ceres</h3>

<p>As shown above, the <em>pbcromwell run</em> command requires a cromwell config file for the jobs to be submitted via SLURM. On ceres, the config files are avaiable in a central location. Users can point to the files directly or can copy and modify based on their individual requirements. The config files are located at</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/system/smrtanalysis/10/slurm_template/cromwell-slurm-short.conf
/system/smrtanalysis/10/slurm_template/cromwell-slurm-medium.conf
/system/smrtanalysis/10/slurm_template/cromwell-slurm-mem.conf
</code></pre></div></div>
<p>The file names correspond to the partitions the jobs will be submitted to.</p>

<p>Priority users can copy those files to their work directory and modify the following (lines 130-131)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        runtime-attributes = """
        Int cpu = 8
        Int requested_memory_mb_per_core = 8000
        String queue_name = "short"
        String? jms_args
        """
</code></pre></div></div>

<p>to</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        runtime-attributes = """
        Int cpu = 8
        Int requested_memory_mb_per_core = 8000
        String queue_name = "priority"
        String? jms_args = "--qos=your_QOS --time=14:00:00" 
        """
</code></pre></div></div>

<p>Users can also modify the CPU threads or memory per core values but these default values should suffice for most workflows.</p>

<h3 id="sample-batch-script">Sample batch script</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/bin/bash

#SBATCH -N 1 # No. of nodes used
#SBATCH -n 4      # Threads 
#SBATCH -t 240    # Minutes

module load smrtlink/10

pbcromwell run pb_assembly_hifi \
      -e input1.consensusreadset.xml \
      --task-option reads=None \                       # Task options vary based on the workflow
      --task-option ipa2_genome_size=0 \               # These task options are optional and will use default values if not specified
      --task-option ipa2_downsampled_coverage=0 \
      --task-option ipa2_advanced_options="" \
      --task-option ipa2_run_polishing=True \
      --task-option ipa2_run_phasing=True \
      --task-option ipa2_run_purge_dups=True \
      --task-option ipa2_ctg_prefix="ctg." \
      --task-option ipa2_reads_db_prefix="reads" \
      --task-option ipa2_cleanup_intermediate_files=True \
      --task-option dataset_filters="" \
      --task-option filter_min_qv=20 \
      --config /system/smrtanalysis/10/slurm_template/cromwell-slurm-short.conf \
      --nproc 8 \                                     # this option is required for some stages in the pipeline
      --backend SLURM \                               # Set the default backend
      --tmp-dir \${TMPDIR} \                          # Use TMPDIR variable
      -c 8 \                                          # Number of chunks
      --output-dir hifi-out			      # 
</code></pre></div></div>

      </main>
    </div>
  </div>
</div>

      </main>
    

    

    


  
<footer class="usa-footer usa-footer--big">

  
    <div class="grid-container">
      <p>Last updated: October 07, 2021 at 08:19 PM</p>
    </div>
  

  
    <div class="grid-container usa-footer__return-to-top">
      <a href="#">Return to top</a>
    </div>
  



  
    
    
    
  <div class="usa-footer__primary-section">
    <div class="grid-container">
      <div class="grid-row grid-gap">
        <div class="">
          <nav class="usa-footer__nav" aria-label="Footer navigation">
            <div class="grid-row grid-gap-4">
              
              <div class="mobile-lg:grid-col-6 desktop:grid-col-4">
                <section class="usa-footer__primary-content usa-footer__primary-content--collapsible">
                  
                    <h4 class="usa-footer__primary-link"></h4>
                    <ul class="usa-list usa-list--unstyled">
                      
                      <li class="usa-footer__secondary-link">
                        <a href="https://usda.gov/policies-and-links">
                          Policies and Links
                        </a>
                      </li>
                      
                      <li class="usa-footer__secondary-link">
                        <a href="https://usda.gov/our-agency/about-usda/performance">
                          Our Performance
                        </a>
                      </li>
                      
                      <li class="usa-footer__secondary-link">
                        <a href="https://www.usda.gov/our-agency/careers">
                          Careers
                        </a>
                      </li>
                      
                      <li class="usa-footer__secondary-link">
                        <a href="https://www.usda.gov/oig/forms/contractor-fraud">
                          Report Fraud on USDA
                        </a>
                      </li>
                      
                      <li class="usa-footer__secondary-link">
                        <a href="https://www.usda.gov/oig/">
                          Visit OIG
                        </a>
                      </li>
                      
                    </ul>
                  
                </section>
              </div>
              
              <div class="mobile-lg:grid-col-6 desktop:grid-col-4">
                <section class="usa-footer__primary-content usa-footer__primary-content--collapsible">
                  
                    <h4 class="usa-footer__primary-link"></h4>
                    <ul class="usa-list usa-list--unstyled">
                      
                      <li class="usa-footer__secondary-link">
                        <a href="https://usda.gov/plain-writing">
                          Plain Writing
                        </a>
                      </li>
                      
                      <li class="usa-footer__secondary-link">
                        <a href="https://usda.gov/open">
                          Open
                        </a>
                      </li>
                      
                      <li class="usa-footer__secondary-link">
                        <a href="https://www.dm.usda.gov/foia/">
                          FOIA
                        </a>
                      </li>
                      
                      <li class="usa-footer__secondary-link">
                        <a href="https://usda.gov/accessibility-statement">
                          Accessibility Statement
                        </a>
                      </li>
                      
                      <li class="usa-footer__secondary-link">
                        <a href="https://usda.gov/privacy-policy">
                          Privacy Policy
                        </a>
                      </li>
                      
                    </ul>
                  
                </section>
              </div>
              
              <div class="mobile-lg:grid-col-6 desktop:grid-col-4">
                <section class="usa-footer__primary-content usa-footer__primary-content--collapsible">
                  
                    <h4 class="usa-footer__primary-link"></h4>
                    <ul class="usa-list usa-list--unstyled">
                      
                      <li class="usa-footer__secondary-link">
                        <a href="https://usda.gov/non-discrimination-statement">
                          Non-Discrimination Statement
                        </a>
                      </li>
                      
                      <li class="usa-footer__secondary-link">
                        <a href="https://www.ascr.usda.gov/civil-rights-statements">
                          Anti-Harassment Policy
                        </a>
                      </li>
                      
                      <li class="usa-footer__secondary-link">
                        <a href="https://www.ocio.usda.gov/policy-directives-records-forms/information-quality-activities">
                          Information Quality
                        </a>
                      </li>
                      
                      <li class="usa-footer__secondary-link">
                        <a href="https://www.usa.gov">
                          USA.gov
                        </a>
                      </li>
                      
                      <li class="usa-footer__secondary-link">
                        <a href="https://www.whitehouse.gov">
                          WhiteHouse.gov
                        </a>
                      </li>
                      
                    </ul>
                  
                </section>
              </div>
              
              <div class="mobile-lg:grid-col-6 desktop:grid-col-4">
                <section class="usa-footer__primary-content usa-footer__primary-content--collapsible">
                  
                    <h4 class="usa-footer__primary-link"></h4>
                    <ul class="usa-list usa-list--unstyled">
                      
                      <li class="usa-footer__secondary-link">
                        <a href="https://usda.gov/federal-web-site-inventory">
                          eGov
                        </a>
                      </li>
                      
                      <li class="usa-footer__secondary-link">
                        <a href="mailto:scinet_vrsc@usda.gov">
                          Feedback
                        </a>
                      </li>
                      
                      <li class="usa-footer__secondary-link">
                        <a href="https://usda.gov/nofear">
                          No FEAR Act Data
                        </a>
                      </li>
                      
                    </ul>
                  
                </section>
              </div>
              
            </div>
          </nav>
        </div>
        
      </div>
    </div>
  </div>
  

  
  <div class="usa-footer__secondary-section">
    <div class="grid-container">
      <div class="grid-row grid-gap">
        <div class="usa-footer__logo grid-row mobile-lg:grid-col-6 mobile-lg:grid-gap-2">
          

          
          <div class="mobile-lg:grid-col-auto">
            <h3 class="usa-footer__logo-heading">USDA Agricultural Research Service</h3>
          </div>
          
        </div>

        
        <div class="usa-footer__contact-links mobile-lg:grid-col-6">
          
          
            <div class="usa-footer__social-links grid-row grid-gap-1">
              <div class="grid-col-auto">
                
                  <a class="usa-social-link usa-social-link--twitter" href="https://twitter.com/USDA_ARS">
                    <span>Twitter</span>
                  </a>
                
              </div>
            </div>
          
          
            <h3 class="usa-footer__contact-heading">Contact us</h3>
            
            
              <address class="usa-footer__address">
                
                <div class="usa-footer__contact-info grid-row grid-gap">
                
                    <div class="grid-col-auto">
                      <a href="mailto:scinet_vrsc@usda.gov">
                        scinet_vrsc@usda.gov
                      </a>
                    </div>
                
                </div>
              </address>
          
        
      </div>
      
      </div>
    </div>
  </div>
  

</footer>





    





  
    
      <script src="/assets/uswds/js/uswds.min.js" async></script>
    

  
    
      <script src="/assets/js/vendor/anchor.min.js"></script>
    

  
    
      <script src="/assets/js/main.js"></script>
    

  
    




<script type="text/javascript">
//<![CDATA[
      var usasearch_config = { siteHandle:"scinet-usda" };

      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src = "//search.usa.gov/javascripts/remote.loader.js";
      document.getElementsByTagName("head")[0].appendChild(script);

//]]>
</script>



  </body>
</html>
